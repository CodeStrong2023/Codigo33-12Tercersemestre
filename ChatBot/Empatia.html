<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>EmpatIA - tu Chatbot de Asistencia Emocional</title>
    <link rel="icon" type="image/png" href="Imagenes/png (1).png">
    
    <!-- Enlace a CSS -->
    <link rel="stylesheet" href="Empatia.css">

</head>

<body>
    <!-- Contenedor principal -->
    <div class="container">

        <!-- Contenedor izquierdo -->
        <div class="left-container">
            <img src="Imagenes/empatiaFace.png" alt="Imagen de empatía">
        </div>

        <!-- Contenedor derecho -->
        <div class="right-container">

            <!-- Ventana de chat -->
            <div id="chat">

                <!-- Cabecera del chatbot -->
                <!-- Área de mensajes -->
                <div id="message-area">

                <!-- Área de entrada de texto -->
                    <div id="input-area">
                        <input type="text" id="textoEntrada" placeholder="Escribe aquí...">
                        <button id="send-button">Enviar</button>
                    </div>
                </div>
            </div>

        </div>
    </div>
     <!-- Script para la funcionalidad del chatbot -->
     <script type="importmap">
        {
            "imports": {
              "@google/generative-ai": "https://esm.run/@google/generative-ai"
            }
          }
     </script><!--Enlace a JS -->
     <script type="module">
        import { GoogleGenerativeAI } from "@google/generative-ai";
  
        // Fetch your API_KEY
        const API_KEY = "AIzaSyBJJozsxUhisQOVSGdkG1DorxOpEi_GIc0";
  
        // Access your API key (see "Set up your API key" above)
        const genAI = new GoogleGenerativeAI(API_KEY);
  
        // ...
  
        // The Gemini 1.5 models are versatile and work with most use cases
        const model = genAI.getGenerativeModel({ model: "gemini-1.5-flash"});
  
        // ...
        document.getElementById("send-button").addEventListener("click", function guardadodetexto() {
            var textoIngresado = document.getElementById("textoEntrada").value;
        
            if (typeof textoIngresado === undefined || typeof textoIngresado === null || textoIngresado === "" || textoIngresado === " ") {
                return "Por favor, escriba algo antes de enviar el mensaje";
            } else if (textoIngresado.includes(palabrasClave)) {
                return "Lamento escuchar eso, la depresión no debe arruinar tu vida. Si estas pensando en suicidarte o crees que puedes lastimarte, necesitas ayuda de un profesional. En caso de necesitar ayuda inmediata le sugerimos visitar el siguiente sitio web: pi.findahelpine.com";
                return "Fui creado con el fin de proteger la salud mental de mis usuarios, busca ayuda y no te des por vencido, tu vida vale mucho.";
            } else {
              run(textoIngresado);
            } 
            // Acá se guarda el texto
        });

        //Funcion que genera respuesta de ia
        async function run(msg) {
            // For text-only input, use the gemini-pro model
            const model = genAI.getGenerativeModel({ model: "gemini-pro"});
          
            try {const chat = model.startChat({
              history: [
                {
                  role: "user",
                  parts: [{ text: "Hola" }],
                },
                {
                  role: "model",
                  parts: [{ text: "Bienvenido, cuentame ¿Cómo te sientes? " }],
                },
              ],
              generationConfig: {
                maxOutputTokens: 100,
              },
            });
            //textoingresado llama a la variable de arriba creada y traida del index
            const result = await chat.sendMessage(msg);
            const response = await result.response;
            return response.text();
          } catch (error) {
            console.error('Error al comunicarse con el chatbot:', error);
            return 'Lo siento, ha ocurrido un error. Inténtalo de nuevo.';
          }
        }

        // Función para agregar mensajes a la ventana del chat
        function addMessage(sender, text) {
            let messageArea = document.getElementById('message-area');
            let messageDiv = document.createElement('div');
            messageDiv.classList.add('message', sender + '-message');

            let messageContent = document.createElement('div');
            messageContent.classList.add('message-content');
            messageContent.innerHTML = '<p>' + text + '</p>';

            messageDiv.appendChild(messageContent);
            messageArea.appendChild(messageDiv);
            messageArea.scrollTop = messageArea.scrollHeight;
        }

        //Palabras en la que el chat esta alerta 
        const palabrasClave = ["Me gustaría estar muerto","Desearía no haber nacido","A veces, quisiera desaparecer",
        "Un día de estos me van a encontrar muerto","Se van a librar de mí","Ya no quiero vivir más","Los demás van a estar mejor sin mí",
        "La única solución es matarme","Ya no puedo estar con este dolor", "Me quiero morir", "Estoy pensando en suicidarme",
        "matarme", "suicidarme", "morirme"
        ];
      </script>

</body>

</html>